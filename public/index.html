<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Chat Room</title>
   </head>
   <body>
      <h1>People in the server: <span id="peopleCount">0</span></h1>
      <h1>Server id: <span id="serverId">Loading..</span></h1>
      <script>
         document.addEventListener("DOMContentLoaded", () => {
            // Get the current host and port
            const host = window.location.hostname;
            const port = window.location.port;

            // Connect to the server
            const ws = new WebSocket(`ws://${host}:${port}`);

            const peopleCount = document.getElementById("peopleCount");
            const serverId = document.getElementById("serverId");

            const updatePeopleCount = count => {
               peopleCount.textContent = count;
            };
            const updateServerId = id => {
               serverId.textContent = id;
            };

            ws.onopen = () => {
               ws.send(JSON.stringify({ requestType: "getConnectedPeopleNum" }));
               ws.send(JSON.stringify({ requestType: "getServerInfos" }));
            };

            ws.onmessage = event => {
               const { eventType, eventData } = JSON.parse(event.data);

               if (eventType === "onGetServerInfos") {
                  updateServerId(eventData.id);
               }
               if (eventType === "onConnectedPeopleNum" || eventType === "onConnectedPeopleNumChanged") {
                  updatePeopleCount(eventData.count);
               }
            };

            ws.onclose = () => {
               console.log("WebSocket connection closed.");
            };
         });
      </script>
   </body>
</html>
